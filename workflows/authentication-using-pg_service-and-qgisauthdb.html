<!DOCTYPE html>
<html lang="en-gb">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>OSGS - Authentication of Postgres using a pg_service file and a qgis-auth.db file.</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" integrity="sha256-NuCn4IvuZXdBaFKJOAcsU2Q3ZpwbdFisd5dux4jkQ5w=" crossorigin="anonymous"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap-theme.css" integrity="sha256-xOpS+e/dER8z72w+qryCieOGysQI8cELAVt3MHG0phY=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tooltipster@4.2.7/dist/css/tooltipster.bundle.min.css" integrity="sha256-Qc4lCfqZWYaHF5hgEOFrYzSIX9Rrxk0NPHRac+08QeQ=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tooltipster@4.2.7/dist/css/plugins/tooltipster/sideTip/themes/tooltipster-sideTip-light.min.css" integrity="sha256-Wa1I4jhSXeWd3N6RhfPlkqr1WlT+zS3Vh2YGCg0129E=" crossorigin="anonymous">
<link href="https://fonts.googleapis.com/css?family=Open+Sans|Source+Code+Pro|Source+Sans+Pro|Source+Serif+Pro|Roboto|Roboto+Mono" rel="stylesheet">
<link href="https://fonts.red-dove.com/iosevka-ss09-regular/webfont.css" rel="stylesheet">

    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/sizzle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/sizzle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/css.css" type="text/css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js" integrity="sha256-G7A4JrJjJlFqP0yamznwPjAApIKPkadeHfyIwiaa9e0=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/tooltipster@4.2.7/dist/js/tooltipster.bundle.min.js" integrity="sha256-NOU7KrY2aTI4PxDegqYUIknk9qfxVCS0E4JfE9aMwaA=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false,
        SOURCELINK_SUFFIX: '.txt'
      };
      $(document).data('sizzle', {on_load: []});
    </script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/js/js.js"></script>
      <script src="../../app-data.js"></script>
<link rel="index" title="Index" href="../genindex.html" />
<link rel="search" title="Search" href="../search.html" />
<link rel="next" title="Publishing changes to the static website - TODO" href="publishing-changes-to-static-website.html" />
<link rel="prev" title="QGIS Desktop as a Web Services Client" href="qgis-desktop-as-web-service-client.html" />

</head>
<body class="full-height test">
<noscript>
  <div>
    <div id="noscript-message">JavaScript is not enabled. It is needed for this website to work.</div>
  </div>
</noscript>
<div id="whole-page" class="container-fluid content full-height">
  <div id="header-row" class="row">
    <div id="header-container" class="col-md-12">
      <div id="hdr-left">
        <i class="fa fa-bars menu-toggle"></i>
        
<a href="../index.html" class="text-logo">OSGS 1.0 documentation</a>

      </div>
      <div id="hdr-centre" class="text-center stretch">
        <h3 title="Authentication of Postgres using a pg_service file and a qgis-auth.db file.">Authentication of Postgres using a pg_service file and a qgis-auth.db file.</h3>
        <h6>Authentication of Postgres using a pg_service file and a qgis-auth.db file.</h6>
      </div>
      <div id="hdr-search">
        
<div class="input-group" title="Enter something to search for and then either press Enter or click the magnifying glass">
  <input type="text" class="form-control search-query" placeholder="Search docs ...">
  <div class="input-group-addon">
    <i class="fa fa-search"></i>
  </div>
</div>
      </div>

      <div id="hdr-source">
        <a href="../_sources/workflows/authentication-using-pg_service-and-qgisauthdb.md.txt" class="btn btn-default" title="See the source for this page"><i class="fa fa-code"></i></a>
      </div>

      <div id="hdr-right">
        
  
  <div class="prev-next">
    
      <div class="pull-left">
        <a class="btn btn-default prev" href="qgis-desktop-as-web-service-client.html" title="Previous chapter (QGIS Desktop as a Web Services Client)"><i class="fa fa-chevron-left mr-1em" aria-hidden="true"></i><span class="btn-text">QGIS Desktop as a Web Services Client</span></a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default next" href="publishing-changes-to-static-website.html" title="Next chapter (Publishing changes to the static website - TODO)"><span class="btn-text">Publishing changes to the static website - TODO</span>&nbsp;<i class="fa fa-chevron-right ml-1em" aria-hidden="true"></i></a>
      </div>
    </div>
  
      </div>
      <div id="alt-hdr-right">

        <a href="qgis-desktop-as-web-service-client.html"><i class="fa fa-chevron-left mr-8"></i></a>


        <a href="../index.html"><i class="fa fa-home mr-8"></i></a>


        <a href="../search.html"><i class="fa fa-search mr-8"></i></a>



        <a href="publishing-changes-to-static-website.html"><i class="fa fa-chevron-right"></i></a>

      </div>
    </div>
  </div>

  <div id="content-row" class="row">
    <div id="page-content" class="col-md-12 flex-col">
      <div id="content-container">
        <div id="nav">
          
  <div class="navsidebar">
    <div id="sidebar-search">
      
<div class="input-group" title="Enter something to search for and then either press Enter or click the magnifying glass">
  <input type="text" class="form-control search-query" placeholder="Search docs ...">
  <div class="input-group-addon">
    <i class="fa fa-search"></i>
  </div>
</div>
    </div>
      <div class="sidebar-block">
        <div class="sidebar-tocheading">
          <div class="pull-left">
            <h2>Table Of Contents</h2>
          </div>
          <div class="pull-right" title="Hide this sidebar (hover at left edge to bring it back)"><i class="fa fa-chevron-left hidetoc"></i></div>
        </div>
        <div class="sidebar-toc">
      
        <div style="clear: both"></div>
      
        
  
    <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html#introduction">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/index.html#services">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utilities/index.html#utilities">Utilities</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html#osgs">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../blueprints/index.html#blueprints">Blueprints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ.html#troubleshooting-faq">Troubleshooting FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roadmap.html#osgs-roadmap">OSGS Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Credits.html#credits">Credits</a></li>
</ul>

  
        </div>
      </div>
  </div>
        </div>
        <div id="content" tabindex="0" class="stretch">
          <div id="mnav">
            
  
    <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html#introduction">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/index.html#services">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utilities/index.html#utilities">Utilities</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html#osgs">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../blueprints/index.html#blueprints">Blueprints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ.html#troubleshooting-faq">Troubleshooting FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roadmap.html#osgs-roadmap">OSGS Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Credits.html#credits">Credits</a></li>
</ul>

  
          </div>
          <div class="body">
            
  <div class="section" id="authentication-of-postgres-using-a-pg-service-file-and-a-qgis-auth-db-file">
<h1>Authentication of Postgres using a pg_service file and a qgis-auth.db file.<a class="headerlink" href="#authentication-of-postgres-using-a-pg-service-file-and-a-qgis-auth-db-file" title="Permalink to this heading">¶</a></h1>
<p>This workflow will demonstrate how to access Postgres in QGIS using a pg_service file and a qgis-auth.db file.</p>
<div class="section" id="deploying-the-osm-mirror-service">
<h2>Deploying the OSM Mirror service<a class="headerlink" href="#deploying-the-osm-mirror-service" title="Permalink to this heading">¶</a></h2>
<div class="section" id="prepare-the-country-pbf-file-and-the-clip-area-document">
<h3>Prepare the Country PBF file and the clip area document<a class="headerlink" href="#prepare-the-country-pbf-file-and-the-clip-area-document" title="Permalink to this heading">¶</a></h3>
<p>The PBF files for the country or region of interest can be obtained from <a class="reference external" href="https://download.geofabrik.de/">GeoFabrik</a>. The PBF file used in this workflow was for South Korea and the URL is https://download.geofabrik.de/asia/south-korea-latest.osm.pbf.</p>
<p>The clip area constrains any data being imported into the PostGIS database to a specific geographic area. You will need to save the clip area document as <code class="docutils literal notranslate"><span class="pre">conf/osm_conf/clip.geojson</span></code>. For best performance, a simple rectangle is best, but any complex polygon can be used. The CRS of the geojson should always be <code class="docutils literal notranslate"><span class="pre">EPSG:4326</span></code>.</p>
<p><img alt="&quot;OSM Clip Area&quot;" src="../_images/osm-mirror-workflow-1.png" /></p>
<p>You can easily create such a clip document at  https://geojson.io or by using QGIS. For this workflow the clip area document for Seoul, South Korea, was downloaded from the <a class="reference external" href="https://github.com/southkorea/seoul-maps/blob/master/juso/2015/json/seoul_municipalities_geo_simple.json">southkorea/seoul-maps</a> repository.</p>
</div>
<div class="section" id="deploy-the-initial-stack">
<h3>Deploy the initial stack<a class="headerlink" href="#deploy-the-initial-stack" title="Permalink to this heading">¶</a></h3>
<p>In your server terminal, deploy the initial stack by running either <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">configure-ssl-self-signed</span></code> or <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">configure-letsencrypt-ssl</span></code>. The initial stack consists of the Nginx, Hugo Watcher and Watchtower services.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">configure-ssl-self-signed</span></code> if you are going to use a self-signed certificate on a localhost for testing. Use <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">configure-letsencrypt-ssl</span></code> if you are going to use a Let’s Encrypt signed certificate on a name host for production. The <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">configure-ssl-self-signed</span></code> will deploy the Nginx, Hugo Watcher and Watchtower services, but after running <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">configure-letsencrypt-ssl</span></code> you will need to run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">deploy-hugo</span></code> to deploy the Nginx, Hugo Watcher and Watchtower services.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">ps</span></code> to view the services running. The following services should be up:</p>
<p><img alt="Initial Stack" src="../_images/pg-service-1.png" /></p>
</div>
<div class="section" id="deploy-the-postgresql-and-postgis-service">
<h3>Deploy the PostgreSQL and PostGIS service<a class="headerlink" href="#deploy-the-postgresql-and-postgis-service" title="Permalink to this heading">¶</a></h3>
<p>Deploy the PostgreSQL and  PostGIS service using <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">deploy-postgres</span></code>. If you already have PostgreSQL installed on your local machine, ensure that you specify a different port number for the Postgis Public Port other than port 5432, the default port for PostgreSQL. For example, you can use the port number 5434.</p>
<p><img alt="Postgis Public Port" src="../_images/pg-service-2.png" /></p>
<p>Use <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">ps</span></code> to view the services running. The following services should be up:</p>
<p><img alt="Services Up" src="../_images/pg-service-3.png" /></p>
</div>
<div class="section" id="deploy-the-osm-mirror-service">
<h3>Deploy the OSM mirror service<a class="headerlink" href="#deploy-the-osm-mirror-service" title="Permalink to this heading">¶</a></h3>
<p>Deploy the OSM mirror service using <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">deploy-osm-mirror</span></code> and follow the subsequent prompts. Use <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">ps</span></code> to view the services running. The following services should be up:</p>
<p><img alt="Services Up" src="../_images/osm-mirror-workflow-13.png" /></p>
<p>You can view the logs for the OSM mirror service using the command <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">osm-mirror-logs</span></code>.</p>
</div>
</div>
<div class="section" id="deploying-qgis-server">
<h2>Deploying QGIS Server<a class="headerlink" href="#deploying-qgis-server" title="Permalink to this heading">¶</a></h2>
<p>To deploy the QGIS Server service, run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">deploy-qgis-server</span></code>. Use <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">ps</span></code> to view the services running. The following services should be up:</p>
<p><img alt="Services Up" src="../_images/publish-using-pgservice-file-4.png" /></p>
</div>
<div class="section" id="deploying-the-file-browser-service">
<h2>Deploying the File Browser service<a class="headerlink" href="#deploying-the-file-browser-service" title="Permalink to this heading">¶</a></h2>
<p>To deploy the File Browser service run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">deploy-file-browser</span></code>. The file browser service can now be accessed on <code class="docutils literal notranslate"><span class="pre">/files/</span></code> e.g. https://localhost/files.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">ps</span></code> to view the services running. The following services should be up:</p>
<p><img alt="Services Up" src="../_images/pgservice-authdb-6.png" /></p>
</div>
<div class="section" id="editing-your-local-connection-service-file">
<h2>Editing your local connection service file<a class="headerlink" href="#editing-your-local-connection-service-file" title="Permalink to this heading">¶</a></h2>
<p>On your local machine (where you have QGIS Desktop installed), the per-user connection service file can be at <code class="docutils literal notranslate"><span class="pre">~/.pg_service.conf</span></code> or the location specified by the environment variable <code class="docutils literal notranslate"><span class="pre">PGSERVICEFILE</span></code>. Add a service to this connection service file with the following service name and connection parameters.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">osgs</span><span class="p">]</span>
<span class="n">dbname</span><span class="o">=</span><span class="n">gis</span>
<span class="n">port</span><span class="o">=&lt;</span><span class="n">POSTGRES_PUBLIC_PORT</span><span class="o">&gt;</span>
<span class="n">host</span><span class="o">=</span>
<span class="n">sslmode</span><span class="o">=</span><span class="n">require</span>
</pre></div>
</div>
<p>For the host connection parameter, use the hostname of the server where you have set up OSGS.</p>
</div>
<div class="section" id="setting-up-your-postgis-connection-in-qgis-desktop">
<h2>Setting up your PostGIS connection in QGIS Desktop<a class="headerlink" href="#setting-up-your-postgis-connection-in-qgis-desktop" title="Permalink to this heading">¶</a></h2>
<p>On your local machine, open QGIS Desktop.  In your Browser Panel,  right click on the PostGIS option and click on “New Connection”. This will open the Create a New PostGIS Connection dialogue.</p>
<p><img alt="New PostGIS connection" src="../_images/pg-service-5.png" /></p>
<p>In the Connection Information section, give the connection an appropriate name. For the service, enter the service name that you specified in the <a class="reference internal" href="#editing-your-local-connection-service-file"><span class="std std-doc">connection service file</span></a>. Set the SSL mode to <code class="docutils literal notranslate"><span class="pre">require</span></code> and ensure you have enabled the <code class="docutils literal notranslate"><span class="pre">Also</span> <span class="pre">list</span> <span class="pre">tables</span> <span class="pre">with</span> <span class="pre">no</span> <span class="pre">geometry</span></code> and the <code class="docutils literal notranslate"><span class="pre">Allow</span> <span class="pre">saving/loading</span> <span class="pre">QGIS</span> <span class="pre">projects</span> <span class="pre">in</span> <span class="pre">database</span></code> options.</p>
<p>In the Configurations tab of Authentication section, click on the “plus” icon to create a new authentication configuration.</p>
<p><img alt="New Authentication Configuration" src="../_images/pgservice-authdb-1.png" /></p>
<p>If prompted, set a new master password. You must define a master password to store or access sensitive information within the QGIS authentication database. For more details on the QGIS authentication system, see the <a class="reference external" href="https://docs.qgis.org/3.16/en/docs/user_manual/auth_system/auth_overview.html#authentication-database">QGIS documentation</a>.</p>
<p><img alt="Set Master Password" src="../_images/pgservice-authdb-13.png" /></p>
<p>Give the new authentication configuration an appropriate name. Ensure the authentication method is set to <code class="docutils literal notranslate"><span class="pre">Basic</span> <span class="pre">authentication</span></code>. For the username and password parameters, use the POSTGRES_USER and POSTGRES_PASSWORD specified in the <code class="docutils literal notranslate"><span class="pre">.env</span></code> file. Click “Save”. These credentials are now saved in the QGIS authentication database <code class="docutils literal notranslate"><span class="pre">qgis-auth.db</span></code>.</p>
<p><img alt="New Authentication Configuration Details" src="../_images/pgservice-authdb-2.png" /></p>
<p>From the Configurations drop down, select the name of the authentication configuration you just created above.</p>
<p><img alt="New Authentication Details" src="../_images/pgservice-authdb-3.png" /></p>
<p>Once all the configuration options have been set, click on “Test Connection”. Once you see the <code class="docutils literal notranslate"><span class="pre">Connection</span> <span class="pre">to</span> <span class="pre">&lt;Name&gt;</span> <span class="pre">was</span> <span class="pre">successful</span></code> message, click “OK”. You have now successfully connected to the PostgreSQL and PostGIS service <code class="docutils literal notranslate"><span class="pre">gis</span></code> database.</p>
<p><img alt="Test Connection" src="../_images/pgservice-authdb-4.png" /></p>
<div class="section" id="view-the-authentication-configuration-id">
<h3>View the authentication configuration ID<a class="headerlink" href="#view-the-authentication-configuration-id" title="Permalink to this heading">¶</a></h3>
<p>To view the ID for the authentication configuration you created in the above section, go to Configurations in the Authentication tab of the QGIS options dialogue (Settings&gt;&gt;Options).</p>
<p><img alt="Configuration ID" src="../_images/pgservice-authdb-7.png" /></p>
</div>
</div>
<div class="section" id="create-a-qgis-project-from-the-osm-mirror-layers">
<h2>Create a QGIS project from the OSM Mirror layers<a class="headerlink" href="#create-a-qgis-project-from-the-osm-mirror-layers" title="Permalink to this heading">¶</a></h2>
<p>In the QGIS Browser Panel, select the <code class="docutils literal notranslate"><span class="pre">osm_admin</span></code>, <code class="docutils literal notranslate"><span class="pre">osm_waterways_rivers</span></code> and <code class="docutils literal notranslate"><span class="pre">osm_waterways_streams</span></code> layers from the <code class="docutils literal notranslate"><span class="pre">osm</span></code> schema and add them to a new QGIS project. Save the project in the Postgres service <code class="docutils literal notranslate"><span class="pre">gis</span></code> database using Project&gt;&gt;Save To&gt;&gt;PostgreSQL.</p>
<p><img alt="Save Project in Database" src="../_images/pgservice-authdb-8.png" /></p>
<p>Save the project in the <code class="docutils literal notranslate"><span class="pre">public</span></code> schema of the osgs connection and name it <code class="docutils literal notranslate"><span class="pre">seoul_rivers</span></code>.</p>
<p><img alt="Save Project in Database" src="../_images/pgservice-authdb-9.png" /></p>
<p>The project is now saved in the <code class="docutils literal notranslate"><span class="pre">qgis_projects</span></code> table in the <code class="docutils literal notranslate"><span class="pre">public</span></code> schema of the <code class="docutils literal notranslate"><span class="pre">gis</span></code> database.</p>
<p><img alt="Seoul Rivers Project" src="../_images/pgservice-authdb-10.png" /></p>
</div>
<div class="section" id="upload-the-qgis-auth-db-file">
<h2>Upload the qgis-auth.db file<a class="headerlink" href="#upload-the-qgis-auth-db-file" title="Permalink to this heading">¶</a></h2>
<p>The file browser service can be accessed on <code class="docutils literal notranslate"><span class="pre">/files/</span></code> e.g. https://localhost/files. The url will direct you to the Login page. Sign in to the service using the File Browser username <code class="docutils literal notranslate"><span class="pre">&lt;FILEBROWSER_USER&gt;</span></code> and password <code class="docutils literal notranslate"><span class="pre">&lt;FILEBROWSER_PASSWORD&gt;</span></code> specified in the <code class="docutils literal notranslate"><span class="pre">.env</span></code> file.</p>
<p><img alt="Log in Page" src="../_images/file-browser-1.png" /></p>
<p>Navigate into the <code class="docutils literal notranslate"><span class="pre">qgis_conf/auth-db/</span></code> folder in File Browser. Delete the <code class="docutils literal notranslate"><span class="pre">qgis-auth.db</span></code> file in the folder.</p>
<p><img alt="Delete File" src="../_images/pgservice-authdb-11.png" /></p>
<p>Upload the <code class="docutils literal notranslate"><span class="pre">qgis-auth.db</span></code> file located in your QGIS Active Profile Folder. This is the QGIS authentication database containing the authentication configuration you created in the <a class="reference internal" href="#setting-up-your-postgis-connection-in-qgis-desktop"><span class="std std-doc">Setting up your PostGIS connection in QGIS Desktop section</span></a>.  This can be accessed via Settings&gt;&gt;User Profiles&gt;&gt;Open Active Profile Folder.</p>
<p><img alt="Open Active Profile Folder" src="../_images/pgservice-authdb-5.png" /></p>
<p>Remove the default string <code class="docutils literal notranslate"><span class="pre">123456</span></code> from the <code class="docutils literal notranslate"><span class="pre">auth-db/qgis-auth-pwd.txt</span></code> file and add the master password to unlock the <code class="docutils literal notranslate"><span class="pre">auth-db/qgis-auth.db</span></code> file you have just uploaded. Remember to save your edits to the file before exiting the text file.</p>
<blockquote>
<div><strong>Note</strong>: Make sure to upload the <code class="docutils literal notranslate"><span class="pre">qgis-auth.db</span></code> file whenever you change it.</div></blockquote>
</div>
<div class="section" id="creating-the-server-side-connection-service-file">
<h2>Creating the server-side connection service file<a class="headerlink" href="#creating-the-server-side-connection-service-file" title="Permalink to this heading">¶</a></h2>
<p>To create the server-side connection service file, run the command <code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">conf/pg_conf/pg_service.conf.example</span> <span class="pre">conf/pg_conf/pg_service.conf</span></code> in the server terminal. In the <code class="docutils literal notranslate"><span class="pre">conf/pg_conf/pg_service.conf</span></code> file, add a service with the following service name and connection parameters.Ensure the service name you use in the server-side connection service file is the same as the service name you used in the <a class="reference internal" href="#editing-your-local-connection-service-file"><span class="std std-doc">local connection service file</span></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">osgs</span><span class="p">]</span>
<span class="n">dbname</span><span class="o">=</span><span class="n">gis</span>
<span class="n">port</span><span class="o">=</span><span class="mi">5432</span>
<span class="n">host</span><span class="o">=</span><span class="n">db</span>
<span class="n">sslmode</span><span class="o">=</span><span class="n">require</span>
</pre></div>
</div>
<p>For the port connection parameter, use the <code class="docutils literal notranslate"><span class="pre">POSTGRES_PRIVATE_PORT</span></code> specified in the <code class="docutils literal notranslate"><span class="pre">.env</span></code> file. For the host connection parameter specify the hostname as <code class="docutils literal notranslate"><span class="pre">db</span></code>.</p>
</div>
<div class="section" id="editing-the-qgis-server-conf-file">
<h2>Editing the <code class="docutils literal notranslate"><span class="pre">qgis-server.conf</span></code> file<a class="headerlink" href="#editing-the-qgis-server-conf-file" title="Permalink to this heading">¶</a></h2>
<p>Edit the <code class="docutils literal notranslate"><span class="pre">conf/nginx_conf/locations/qgis-server.conf</span></code> file by replacing the default PostgreSQL connection string <code class="docutils literal notranslate"><span class="pre">postgresql://?service=nginx&amp;sslmode=disable&amp;schema=public&amp;project=smallholding</span></code> in the <code class="docutils literal notranslate"><span class="pre">location</span> <span class="pre">/qgis-pg/</span></code> section of the file with the PostgreSQL connection string <code class="docutils literal notranslate"><span class="pre">postgresql:?service=osgs&amp;authcfg=f7tn22w&amp;sslmode=require&amp;dbname&amp;schema=public&amp;project=seoul_rivers</span></code> and save the changes. The <code class="docutils literal notranslate"><span class="pre">authcfg</span></code> parameter is the ID of the <a class="reference internal" href="#view-the-authentication-configuration-id"><span class="std std-doc">authentication configuration</span></a> containing the username and password for the Postgres service <code class="docutils literal notranslate"><span class="pre">gis</span></code> database.</p>
<p><img alt="Edit the qgis-server.conf file" src="../_images/pgservice-authdb-14.png" /></p>
<p>Restart the QGIS Server service using <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">restart-qgis-server</span></code>.</p>
</div>
<div class="section" id="using-qgis-desktop-as-a-web-service-client-for-qgis-server-published-layers">
<h2>Using QGIS Desktop as a web service client for QGIS Server published layers<a class="headerlink" href="#using-qgis-desktop-as-a-web-service-client-for-qgis-server-published-layers" title="Permalink to this heading">¶</a></h2>
<p>In your QGIS Desktop Browser panel, right click on the <code class="docutils literal notranslate"><span class="pre">WMS/WMTS</span></code> option and create a new connection.</p>
<p><img alt="New WMS Connection Details" src="../_images/upload-qgis-project-3.png" /></p>
<p>Give the new connection an appropriate name. For the URL parameter, access the published QGIS project via <code class="docutils literal notranslate"><span class="pre">/map/</span></code> i.e. <code class="docutils literal notranslate"><span class="pre">https://&lt;server</span> <span class="pre">name&gt;/map/</span></code>. The <code class="docutils literal notranslate"><span class="pre">&lt;server</span> <span class="pre">name&gt;</span></code> parameter is the hostname of the server where you set up OSGS. Click “OK”.</p>
<p><img alt="New WMS Connection" src="../_images/pgservice-authdb-15.png" /></p>
<p>Once the connection is successful, you can now load into QGIS the project or individual layers as WMS layers. Drag and drop the layers onto the Map View to view the project.</p>
<p><img alt="View WMS Layer" src="../_images/pgservice-authdb-16.png" /></p>
</div>
</div>


          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="footer-row" class="row">

    <div class="col-md-12">
        <span></span><span class="pull-right">&copy; Copyright 2021, Tim Sutton.
        Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.0.2 and the
        <a href="https://pypi.org/project/sphinx-sizzle-theme/"

           title="0.0.9/821a5457 [2020-04-16T19:31:16]"

        >Sizzle</a> theme.</span>
    </div>

  </div>
</div>

<div id="tooltips" class="hidden">
</div>

<script>
$(document).ready(function() {
  'use strict';
  var $search = $('.search-query');

  var $nav = $('#nav');

  //$('#whole-page').removeClass('hidden');
  var nav_width = $nav.width();


  var search_url = '../search.html';

  function perform_search(e) {
    var $elem;

    if (e.type === 'keypress') {
      $elem = $(e.target);
    }
    else if (e.type === 'click') {
      $elem = $(e.target).parents('.input-group').find('input');
    }
    var q = $elem.val().trim();

    if (q) {
      var url = search_url + '?q=' + q + '&check_keywords=yes&area=default';

      location.href = url;
    }
  }



  $search.on('keypress', function(e) {
    if (e.which == 13) {
      perform_search(e);
    }
  });
  $search.parents('.input-group').find('.input-group-addon').on('click', perform_search);
  $(document).on('click', '.summary .fa-caret-right', function(e) {
    var $elem = $(e.target).parents('li');
    var $next = $elem.next();
    $elem.addClass('hidden');
    $next.removeClass('hidden');
  });
  $(document).on('click', '.detail .fa-caret-down', function(e) {
    var $elem = $(e.target).parents('li');
    var $prev = $elem.prev();
    $elem.addClass('hidden');
    $prev.removeClass('hidden');
  });

  $('#content').on('click', function() {
    $('#mnav').hide();
  });

  var counter = 0;
  var timer = null;

  function show_nav() {
    $('#content').off('mousemove', track_mouse);
    if (timer !== null) {
      clearTimeout(timer);
      timer = null;
    }
    $nav.show();
  }

  function track_mouse(e) {
    var x = e.clientX;

    if (x < 15) {
      ++counter;
      if (timer === null) {
        timer = setTimeout(show_nav, 2000);
      }
    }
    else {
      counter = 0;
    }
    if (counter >= 20) {
      show_nav();
    }
  };

  function hide_nav() {
    $nav.hide();
    counter = 0;
    $('#content').on('mousemove', track_mouse);
  }

  $('.hidetoc').on('click', hide_nav);

  $(document).on('keyup', function(e) {
    if (e.ctrlKey) {
      if (e.which == 37) {      // Ctrl+left arrow
        hide_nav();
      }
      else if (e.which == 39) { // Ctrl+right arrow
        show_nav();
      }
    }
  });

  $('.menu-toggle').on('click', function(e) {
    $('#mnav').toggle();
  });

  function scroll_nav(frag) {
    var sel = '#nav ' + (frag ? 'a[href="' + frag + '"]' : '.toctree-l1 a.current');

    var $link = $(sel);

    if ($link.length > 0) {
      $link[0].scrollIntoView({block: 'center'});
    }
  }

  // If the navigator is long, then the item we clicked on to get here might
  // not be in view. Try to scroll it into the view - a slight delay is needed
  // to get it to sync properly with other stuff going on (as the page has just
  // loaded). Hence the setTimeout with a timeout of 0.

  function do_scroll() {
    scroll_nav(window.location.hash);
  }

  setTimeout(do_scroll, 0);

  function adjust_size() {
    // we need to set the height explicitly so that scrolling regions in the
    // content area work properly.
    var h = $('#page-content').height();

    $('#nav, #content').height(h);
    if ($('#nav').is(':visible')) {
      $('#mnav').hide();
    }
  }

  adjust_size();

  $(window).on('resize', adjust_size);

  function focus_content() {
    $('#content').focus();  // so that keyboard can be used to scroll, etc.
  }

  setTimeout(focus_content, 150);

  var sizzle = $(document).data('sizzle');

  function make_tooltip(id, h, b) {
    var $e = $('<div>').attr('id', id);
    var $b = $('<div>').addClass('tc-body').html(b);

    if (h) {
      var $h = $('<div>').addClass('tc-heading').html(h);
      $e.append($h);
    }
    $e.append($b);
    return $e;
  }

  var default_tt_options = {
    theme: ['tooltipster-light', 'tooltipster-light-customized'],
    interactive: true,
    maxWidth: 600,
    contentCloning: true
  };

  function activate_tooltips() {
    var $tt = $('.tt');

    //console.log('tt links:', $tt.length);
    $tt.tooltipster(default_tt_options);
  }



  function add_glossary_tooltips() {
    var links = $('a');  // can qualify with .reference.internal
    var glinks = {};
    var pat = /(.*)\.html#(term-.*)$/;
    var found = false;  // links in this document

    $.each(links, function(i, link) {
        var $link = $(link);
        var href = $link.attr('href');
        var m = href.match(pat);

        if (m) {
          var s = m[1].replace(/^(\.\.\/)+/, '');

          if (s === sizzle.app_data.glossary.document) {
            var k = m[2];

            if (k in glinks) {
              glinks[k].push($link);
            }
            else {
              glinks[k] = [$link];
            }
            found = true;
          }
        }
    });
    if (found) {
      var $t = $('#tooltips');
      var data = sizzle.app_data.glossary.terms;

      $.each(glinks, function(k, v) {
        var d = data[k];

        if (d) {  // as a sanity check
          var s = 'tc-'+ k;
          var $e = make_tooltip(s, d.term, d.defn);
          $t.append($e);

          $.each(v, function(i, link) {
            link.addClass('tt').attr('data-tooltip-content', '#' + s);
          });
        }
      });
    }
  }

  if (sizzle.app_data && sizzle.app_data.glossary &&
      sizzle.app_data.glossary.document) {
    add_glossary_tooltips();
  }




  function add_custom_tooltips() {
    var info_tips = sizzle.app_data.custom_data['info-tips'] || {};

    if ($.isEmptyObject(info_tips)) {
      return;
    }

    var tt_options = $.extend({contentAsHTML: true}, default_tt_options);

    $('.tc-info').each(function() {
      var $elem = $(this).prev();
      var classes = $elem.attr('class');
      var m = /\btci-([\S]+)/.exec(classes);

      if (m !== null) {
        var key = m[1];

        if (key in info_tips) {
          var v = info_tips[key];
          var tt = $elem.tooltipster(tt_options).tooltipster('content', v);
        }
      }
    });
  }

  add_custom_tooltips();

  setTimeout(activate_tooltips, 1000);


  // Clipboard copy for code blocks with captions

  $('.code-block-caption').each(function() {
    var $cap = $(this);
    var $btn = $('<span class="clip-copy"><span class="copied hidden">Copied!</span><i class="fa fa-clipboard" title="Copy contents"></i></span>');
    var $code = $cap.parent().find('.highlight');

    $cap.append($btn);
    $btn.find('.fa-clipboard').data('clip-text', $code.text());
  });

  var clipboard = new ClipboardJS('.code-block-caption .fa-clipboard', {
    'text': function(trigger) {
      return $(trigger).data('clip-text');
    }
  });

  clipboard.on('success', function(e) {
    var $copied = $(e.trigger).prev();

    $copied.removeClass('hidden');

    setTimeout(function() {$copied.addClass('hidden'); }, 1000);
  });

  if (sizzle.on_load) {
    sizzle.on_load.forEach(function(f) {
      f();
    });
  }
});
</script>
</body>
</html>